/*! videojs-markers - v1.0.1 - 2018-07-11
* Copyright (c) 2018 ; Licensed  */

!function(e,t){if("function"==typeof define&&define.amd)define(["video.js"],t);else if("undefined"!=typeof exports)t(require("video.js"));else{t(e.videojs),e.videojsMarkers={}}}(this,function(e){"use strict";var t,p=(t=e)&&t.__esModule?t:{default:t};var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,t){},onMarkerTextKeyPress:function(e,t){},onMarkerTextClick:function(e,t){},onMarkerTextDeleted:function(e,t){},markers:[],rightThreshold:80,bookmarkPlaceHolder:"enter bookmark title"};var T=-1;p.default.plugin("markers",function(n){if(!p.default.mergeOptions){var o=function(e){return!!e&&"object"===(void 0===e?"undefined":h(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};p.default.mergeOptions=function a(e,t){var i={};return[e,t].forEach(function(r){r&&Object.keys(r).forEach(function(e){var t=r[e];o(t)?(o(i[e])||(i[e]={}),i[e]=a(i[e],t)):i[e]=t})}),i}}p.default.createEl||(p.default.createEl=function(e,t,r){var a=p.default.Player.prototype.createEl(e,t);return r&&Object.keys(r).forEach(function(e){a.setAttribute(e,r[e])}),a});var f=p.default.mergeOptions(b,n),i={},l=[],c=T,k=this,d=null,u=T;function t(){l.sort(function(e,t){return f.markerTip.time(e)-f.markerTip.time(t)})}function r(e){e.forEach(function(e){var a,t,r;k.el().querySelector(".vjs-progress-control").appendChild((a=e,r=p.default.createEl("div",{},{"data-marker-id":a.key,"data-marker-time":f.markerTip.time(a)}),s(a,r),r.addEventListener("click",function(e){var t=!1;if("function"==typeof f.onMarkerClick&&(t=!1===f.onMarkerClick(a)),!t){var r=this.getAttribute("data-marker-id");k.currentTime(f.markerTip.time(i[r]))}}),f.markerTip.display&&((t=r).addEventListener("mouseover",function(){t.classList.add("vjs-bookmark--focus"),t.querySelector(".udi-delete").classList.remove("hide"),t.querySelector(".vjs-bookmark__content").classList.remove("hide"),t.querySelector(".udi-check").classList.remove("show")}),t.addEventListener("mouseout",function(){t.classList.remove("vjs-bookmark--focus")})),r)),i[e.key]=e,l.push(e)}),t()}function m(e){return f.markerTip.time(e)/k.duration()*100}function s(e,t){t.className="vjs-bookmark "+(e.class||"");var r=p.default.createEl("textarea",{className:"marker-content",innerText:e.text,style:"height: 35px;",placeholder:f.bookmarkPlaceHolder,name:"bookmark_title"},{"marker-id":e.key,maxlength:140}),a=p.default.createEl("button",{className:"udi udi-delete",id:"delete-icon-"+e.key,title:"Delete"}),i=p.default.createEl("span",{className:"udi udi-check",id:"check-icon-"+e.key}),n=p.default.createEl("label",{className:"sr-only",for:"bookmark_title",innerText:"Bookmark title"}),o=p.default.createEl("span",{className:"udi udi-bookmark"}),l=p.default.createEl("span",{className:"vjs-bookmark__content__counter",id:"text-counter-"+e.key,innerText:140-r.value.length}),c=p.default.createEl("div",{className:"vjs-bookmark__content",id:"marker-tip-"+e.key});c.appendChild(o),c.appendChild(n),c.appendChild(r),c.appendChild(l),c.appendChild(a),c.appendChild(i);var d=p.default.createEl("div",{});d.appendChild(c),t.appendChild(d),"function"==typeof f.onMarkerTextKeyPress&&r.addEventListener("keypress",function(e){f.onMarkerTextKeyPress(e,r,l)}),"function"==typeof f.onMarkerTextClick&&r.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),f.onMarkerTextClick(e,r)}),"function"==typeof f.onMarkerTextDeleted&&a.addEventListener("click",function(e){f.onMarkerTextDeleted(e,r,l)}),Object.keys(f.markerStyle).forEach(function(e){t.style[e]=f.markerStyle[e]});var u=e.time/k.duration();if((u<0||1<u)&&(t.style.display="none"),m(e)<=f.rightThreshold?t.style.left=m(e)+"%":(t.style.right=100-m(e)+"%",c.style.right="100%"),e.duration)t.style.width=e.duration/k.duration()*100+"%",t.style.marginLeft="0px";else{var s=function(e){var t,r={top:0,bottom:0,left:0,width:0,height:0,right:0};try{t=e.getBoundingClientRect()}catch(e){t=r}return t}(t);t.style.marginLeft=s.width/2+"px"}}function v(e){d&&(u=T,d.style.visibility="hidden"),c=T;var a=[];e.forEach(function(e){var t=l[e];if(t){delete i[t.key],a.push(e);var r=k.el().querySelector(".vjs-bookmark[data-marker-id='"+t.key+"']");r&&r.parentNode.removeChild(r)}}),a.reverse(),a.forEach(function(e){l.splice(e,1)}),t()}function e(){if(f.breakOverlay.display&&!(c<0)){var e=k.currentTime(),t=l[c],r=f.markerTip.time(t);r<=e&&e<=r+f.breakOverlay.displayTime?(u!==c&&(u=c,d&&(d.querySelector(".vjs-break-overlay-text").innerHTML=f.breakOverlay.text(t))),d&&(d.style.visibility="visible")):(u=T,d&&(d.style.visibility="hidden"))}}function a(){!function(){if(l.length){var e=function(e){return e<l.length-1?f.markerTip.time(l[e+1]):k.duration()},t=k.currentTime(),r=T;if(c!==T){var a=e(c);if(t>=f.markerTip.time(l[c])&&t<a)return;if(c===l.length-1&&t===k.duration())return}if(t<f.markerTip.time(l[0]))r=T;else for(var i=0;i<l.length;i++)if(a=e(i),t>=f.markerTip.time(l[i])&&t<a){r=i;break}r!==c&&(r!==T&&n.onMarkerReached&&n.onMarkerReached(l[r],r),c=r)}}(),e(),n.onTimeUpdateAfterMarkerUpdate&&n.onTimeUpdateAfterMarkerUpdate()}function y(){k.markers.removeAll(),r(f.markers),f.breakOverlay.display&&(d=p.default.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(f.breakOverlay.style).forEach(function(e){d&&(d.style[e]=f.breakOverlay.style[e])}),k.el().appendChild(d),u=T),a(),k.on("timeupdate",a),k.off("loadedmetadata")}k.on("loadedmetadata",function(){y()}),k.markers={getMarkers:function(){return l},next:function(){for(var e=k.currentTime(),t=0;t<l.length;t++){var r=f.markerTip.time(l[t]);if(e<r){k.currentTime(r);break}}},prev:function(){for(var e=k.currentTime(),t=l.length-1;0<=t;t--){var r=f.markerTip.time(l[t]);if(r+.5<e)return void k.currentTime(r)}},add:function(e){r(e)},remove:function(e){v(e)},removeByKey:function(e){!function(e){for(var t=l.length,r=[],a=0;a<t;a++)if(l[a].key===e){r.push(a);break}0<r.length&&v(r)}(e)},removeAll:function(){for(var e=[],t=0;t<l.length;t++)e.push(t);v(e)},updateTime:function(e){var a;a=e,l.forEach(function(e){var t=k.el().querySelector(".vjs-bookmark[data-marker-id='"+e.key+"']"),r=f.markerTip.time(e);(a||t.getAttribute("data-marker-time")!==r)&&(s(e,t),t.setAttribute("data-marker-time",r))}),t()},reset:function(e){k.markers.removeAll(),r(e)},destroy:function(){k.markers.removeAll(),d&&d.remove(),k.off("timeupdate",e),delete k.markers}}})});