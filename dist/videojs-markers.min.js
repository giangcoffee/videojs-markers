/*! videojs-markers - v1.0.1 - 2018-05-20
* Copyright (c) 2018 ; Licensed  */

!function(e,t){if("function"==typeof define&&define.amd)define(["video.js"],t);else if("undefined"!=typeof exports)t(require("video.js"));else{t(e.videojs),e.videojsMarkers={}}}(this,function(e){"use strict";var t,p=(t=e)&&t.__esModule?t:{default:t};var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,t){},onMarkerTextKeyPress:function(e,t){},markers:[]};var b=-1;p.default.plugin("markers",function(n){if(!p.default.mergeOptions){var o=function(e){return!!e&&"object"===(void 0===e?"undefined":y(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};p.default.mergeOptions=function a(e,t){var i={};return[e,t].forEach(function(r){r&&Object.keys(r).forEach(function(e){var t=r[e];o(t)?(o(i[e])||(i[e]={}),i[e]=a(i[e],t)):i[e]=t})}),i}}p.default.createEl||(p.default.createEl=function(e,t,r){var a=p.default.Player.prototype.createEl(e,t);return r&&Object.keys(r).forEach(function(e){a.setAttribute(e,r[e])}),a});var m=p.default.mergeOptions(h,n),i={},l=[],c=b,k=this,d=null,u=b;function t(){l.sort(function(e,t){return m.markerTip.time(e)-m.markerTip.time(t)})}function r(e){e.forEach(function(e){var a,r,t;k.el().querySelector(".vjs-progress-holder").appendChild((a=e,t=p.default.createEl("div",{},{"data-marker-id":a.key,"data-marker-time":m.markerTip.time(a)}),s(a,t),t.addEventListener("click",function(e){var t=!1;if("function"==typeof m.onMarkerClick&&(t=!1===m.onMarkerClick(a)),!t){var r=this.getAttribute("data-marker-id");k.currentTime(m.markerTip.time(i[r]))}}),m.markerTip.display&&((r=t).addEventListener("mouseover",function(){r.classList.add("vjs-bookmark--focus");var e=r.querySelector("textarea");e.focus();var t=e.value.length;e.setSelectionRange(t,t)}),r.addEventListener("mouseout",function(){r.classList.remove("vjs-bookmark--focus")})),t)),i[e.key]=e,l.push(e)}),t()}function s(e,t){t.className="vjs-bookmark "+(e.class||"");var r=p.default.createEl("textarea",{className:"marker-content",innerText:e.text,style:"height: 35px;",placeholder:"enter bookmark title",name:"bookmark_title"},{"marker-id":e.key,maxlength:140}),a=p.default.createEl("span",{className:"udi udi-delete",id:"delete-icon-"+e.key}),i=p.default.createEl("span",{className:"udi udi-check",id:"check-icon-"+e.key}),n=p.default.createEl("label",{className:"sr-only",for:"bookmark_title",innerText:"Bookmark title"}),o=p.default.createEl("span",{className:"udi udi-bookmark",id:"check-icon-"+e.key}),l=p.default.createEl("span",{className:"vjs-bookmark__content__counter",id:"text-counter-"+e.key,innerText:140-r.value.length}),c=p.default.createEl("div",{className:"vjs-bookmark__content",id:"text-counter-"+e.key});c.appendChild(o),c.appendChild(n),c.appendChild(r),c.appendChild(l),c.appendChild(a),c.appendChild(i);var d=p.default.createEl("div",{});d.appendChild(c),t.appendChild(d),"function"==typeof m.onMarkerTextKeyPress&&r.addEventListener("keypress",function(e){m.onMarkerTextKeyPress(e,r,l)}),Object.keys(m.markerStyle).forEach(function(e){t.style[e]=m.markerStyle[e]});var u,s=e.time/k.duration();if((s<0||1<s)&&(t.style.display="none"),t.style.left=(u=e,m.markerTip.time(u)/k.duration()*100+"%"),e.duration)t.style.width=e.duration/k.duration()*100+"%",t.style.marginLeft="0px";else{var f=function(e){var t,r={top:0,bottom:0,left:0,width:0,height:0,right:0};try{t=e.getBoundingClientRect()}catch(e){t=r}return t}(t);t.style.marginLeft=f.width/2+"px"}}function a(e){d&&(u=b,d.style.visibility="hidden"),c=b;var a=[];e.forEach(function(e){var t=l[e];if(t){delete i[t.key],a.push(e);var r=k.el().querySelector(".vjs-marker[data-marker-id='"+t.key+"']");r&&r.parentNode.removeChild(r)}}),a.reverse(),a.forEach(function(e){l.splice(e,1)}),t()}function e(){if(m.breakOverlay.display&&!(c<0)){var e=k.currentTime(),t=l[c],r=m.markerTip.time(t);r<=e&&e<=r+m.breakOverlay.displayTime?(u!==c&&(u=c,d&&(d.querySelector(".vjs-break-overlay-text").innerHTML=m.breakOverlay.text(t))),d&&(d.style.visibility="visible")):(u=b,d&&(d.style.visibility="hidden"))}}function f(){!function(){if(l.length){var e=function(e){return e<l.length-1?m.markerTip.time(l[e+1]):k.duration()},t=k.currentTime(),r=b;if(c!==b){var a=e(c);if(t>=m.markerTip.time(l[c])&&t<a)return;if(c===l.length-1&&t===k.duration())return}if(t<m.markerTip.time(l[0]))r=b;else for(var i=0;i<l.length;i++)if(a=e(i),t>=m.markerTip.time(l[i])&&t<a){r=i;break}r!==c&&(r!==b&&n.onMarkerReached&&n.onMarkerReached(l[r],r),c=r)}}(),e(),n.onTimeUpdateAfterMarkerUpdate&&n.onTimeUpdateAfterMarkerUpdate()}function v(){k.markers.removeAll(),r(m.markers),m.breakOverlay.display&&(d=p.default.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(m.breakOverlay.style).forEach(function(e){d&&(d.style[e]=m.breakOverlay.style[e])}),k.el().appendChild(d),u=b),f(),k.on("timeupdate",f),k.off("loadedmetadata")}k.on("loadedmetadata",function(){v()}),k.markers={getMarkers:function(){return l},next:function(){for(var e=k.currentTime(),t=0;t<l.length;t++){var r=m.markerTip.time(l[t]);if(e<r){k.currentTime(r);break}}},prev:function(){for(var e=k.currentTime(),t=l.length-1;0<=t;t--){var r=m.markerTip.time(l[t]);if(r+.5<e)return void k.currentTime(r)}},add:function(e){r(e)},remove:function(e){a(e)},removeAll:function(){for(var e=[],t=0;t<l.length;t++)e.push(t);a(e)},updateTime:function(e){var a;a=e,l.forEach(function(e){var t=k.el().querySelector(".vjs-marker[data-marker-id='"+e.key+"']"),r=m.markerTip.time(e);(a||t.getAttribute("data-marker-time")!==r)&&(s(e,t),t.setAttribute("data-marker-time",r))}),t()},reset:function(e){k.markers.removeAll(),r(e)},destroy:function(){k.markers.removeAll(),d&&d.remove(),k.off("timeupdate",e),delete k.markers}}})});