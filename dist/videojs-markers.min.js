/*! videojs-markers - v1.0.1 - 2018-05-28
* Copyright (c) 2018 ; Licensed  */

!function(e,t){if("function"==typeof define&&define.amd)define(["video.js"],t);else if("undefined"!=typeof exports)t(require("video.js"));else{t(e.videojs),e.videojsMarkers={}}}(this,function(e){"use strict";var t,v=(t=e)&&t.__esModule?t:{default:t};var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,t){},onMarkerTextKeyPress:function(e,t){},onMarkerTextClick:function(e,t){},onMarkerTextDeleted:function(e,t){},markers:[]};var b=-1;v.default.plugin("markers",function(n){if(!v.default.mergeOptions){var o=function(e){return!!e&&"object"===(void 0===e?"undefined":y(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};v.default.mergeOptions=function a(e,t){var i={};return[e,t].forEach(function(r){r&&Object.keys(r).forEach(function(e){var t=r[e];o(t)?(o(i[e])||(i[e]={}),i[e]=a(i[e],t)):i[e]=t})}),i}}v.default.createEl||(v.default.createEl=function(e,t,r){var a=v.default.Player.prototype.createEl(e,t);return r&&Object.keys(r).forEach(function(e){a.setAttribute(e,r[e])}),a});var k=v.default.mergeOptions(h,n),i={},l=[],c=b,m=this,d=null,u=b;function t(){l.sort(function(e,t){return k.markerTip.time(e)-k.markerTip.time(t)})}function r(e){e.forEach(function(e){var a,t,r;m.el().querySelector(".vjs-progress-control").appendChild((a=e,r=v.default.createEl("div",{},{"data-marker-id":a.key,"data-marker-time":k.markerTip.time(a)}),s(a,r),r.addEventListener("click",function(e){var t=!1;if("function"==typeof k.onMarkerClick&&(t=!1===k.onMarkerClick(a)),!t){var r=this.getAttribute("data-marker-id");m.currentTime(k.markerTip.time(i[r]))}}),k.markerTip.display&&((t=r).addEventListener("mouseover",function(){t.classList.add("vjs-bookmark--focus"),t.querySelector(".udi-delete").classList.remove("hide"),t.querySelector(".vjs-bookmark__content").classList.remove("hide"),t.querySelector(".udi-check").classList.remove("show")}),t.addEventListener("mouseout",function(){t.classList.remove("vjs-bookmark--focus")})),r)),i[e.key]=e,l.push(e)}),t()}function s(e,t){t.className="vjs-bookmark "+(e.class||"");var r=v.default.createEl("textarea",{className:"marker-content",innerText:e.text,style:"height: 35px;",placeholder:"enter bookmark title",name:"bookmark_title"},{"marker-id":e.key,maxlength:140}),a=v.default.createEl("span",{className:"udi udi-delete",id:"delete-icon-"+e.key}),i=v.default.createEl("span",{className:"udi udi-check",id:"check-icon-"+e.key}),n=v.default.createEl("label",{className:"sr-only",for:"bookmark_title",innerText:"Bookmark title"}),o=v.default.createEl("span",{className:"udi udi-bookmark"}),l=v.default.createEl("span",{className:"vjs-bookmark__content__counter",id:"text-counter-"+e.key,innerText:140-r.value.length}),c=v.default.createEl("div",{className:"vjs-bookmark__content",id:"marker-tip-"+e.key});c.appendChild(o),c.appendChild(n),c.appendChild(r),c.appendChild(l),c.appendChild(a),c.appendChild(i);var d=v.default.createEl("div",{});d.appendChild(c),t.appendChild(d),"function"==typeof k.onMarkerTextKeyPress&&r.addEventListener("keypress",function(e){k.onMarkerTextKeyPress(e,r,l)}),"function"==typeof k.onMarkerTextClick&&r.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),k.onMarkerTextClick(e,r)}),"function"==typeof k.onMarkerTextDeleted&&a.addEventListener("click",function(e){k.onMarkerTextDeleted(e,r,l)}),Object.keys(k.markerStyle).forEach(function(e){t.style[e]=k.markerStyle[e]});var u,s=e.time/m.duration();if((s<0||1<s)&&(t.style.display="none"),t.style.left=(u=e,k.markerTip.time(u)/m.duration()*100+"%"),e.duration)t.style.width=e.duration/m.duration()*100+"%",t.style.marginLeft="0px";else{var f=function(e){var t,r={top:0,bottom:0,left:0,width:0,height:0,right:0};try{t=e.getBoundingClientRect()}catch(e){t=r}return t}(t);t.style.marginLeft=f.width/2+"px"}}function f(e){d&&(u=b,d.style.visibility="hidden"),c=b;var a=[];e.forEach(function(e){var t=l[e];if(t){delete i[t.key],a.push(e);var r=m.el().querySelector(".vjs-bookmark[data-marker-id='"+t.key+"']");r&&r.parentNode.removeChild(r)}}),a.reverse(),a.forEach(function(e){l.splice(e,1)}),t()}function e(){if(k.breakOverlay.display&&!(c<0)){var e=m.currentTime(),t=l[c],r=k.markerTip.time(t);r<=e&&e<=r+k.breakOverlay.displayTime?(u!==c&&(u=c,d&&(d.querySelector(".vjs-break-overlay-text").innerHTML=k.breakOverlay.text(t))),d&&(d.style.visibility="visible")):(u=b,d&&(d.style.visibility="hidden"))}}function a(){!function(){if(l.length){var e=function(e){return e<l.length-1?k.markerTip.time(l[e+1]):m.duration()},t=m.currentTime(),r=b;if(c!==b){var a=e(c);if(t>=k.markerTip.time(l[c])&&t<a)return;if(c===l.length-1&&t===m.duration())return}if(t<k.markerTip.time(l[0]))r=b;else for(var i=0;i<l.length;i++)if(a=e(i),t>=k.markerTip.time(l[i])&&t<a){r=i;break}r!==c&&(r!==b&&n.onMarkerReached&&n.onMarkerReached(l[r],r),c=r)}}(),e(),n.onTimeUpdateAfterMarkerUpdate&&n.onTimeUpdateAfterMarkerUpdate()}function p(){m.markers.removeAll(),r(k.markers),k.breakOverlay.display&&(d=v.default.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(k.breakOverlay.style).forEach(function(e){d&&(d.style[e]=k.breakOverlay.style[e])}),m.el().appendChild(d),u=b),a(),m.on("timeupdate",a),m.off("loadedmetadata")}m.on("loadedmetadata",function(){p()}),m.markers={getMarkers:function(){return l},next:function(){for(var e=m.currentTime(),t=0;t<l.length;t++){var r=k.markerTip.time(l[t]);if(e<r){m.currentTime(r);break}}},prev:function(){for(var e=m.currentTime(),t=l.length-1;0<=t;t--){var r=k.markerTip.time(l[t]);if(r+.5<e)return void m.currentTime(r)}},add:function(e){r(e)},remove:function(e){f(e)},removeByKey:function(e){!function(e){for(var t=l.length,r=[],a=0;a<t;a++)if(l[a].key===e){r.push(a);break}0<r.length&&f(r)}(e)},removeAll:function(){for(var e=[],t=0;t<l.length;t++)e.push(t);f(e)},updateTime:function(e){var a;a=e,l.forEach(function(e){var t=m.el().querySelector(".vjs-bookmark[data-marker-id='"+e.key+"']"),r=k.markerTip.time(e);(a||t.getAttribute("data-marker-time")!==r)&&(s(e,t),t.setAttribute("data-marker-time",r))}),t()},reset:function(e){m.markers.removeAll(),r(e)},destroy:function(){m.markers.removeAll(),d&&d.remove(),m.off("timeupdate",e),delete m.markers}}})});