/*! videojs-markers - v1.0.1 - 2018-05-20
* Copyright (c) 2018 ; Licensed  */

!function(e,r){if("function"==typeof define&&define.amd)define(["video.js"],r);else if("undefined"!=typeof exports)r(require("video.js"));else{r(e.videojs),e.videojsMarkers={}}}(this,function(e){"use strict";var r,y=(r=e)&&r.__esModule?r:{default:r};var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,r){},markers:[]};var x=-1;y.default.plugin("markers",function(n){if(!y.default.mergeOptions){var o=function(e){return!!e&&"object"===(void 0===e?"undefined":b(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};y.default.mergeOptions=function a(e,r){var i={};return[e,r].forEach(function(t){t&&Object.keys(t).forEach(function(e){var r=t[e];o(r)?(o(i[e])||(i[e]={}),i[e]=a(i[e],r)):i[e]=r})}),i}}y.default.createEl||(y.default.createEl=function(e,r,t){var a=y.default.Player.prototype.createEl(e,r);return t&&Object.keys(t).forEach(function(e){a.setAttribute(e,t[e])}),a});var l=y.default.mergeOptions(h,n),s={},c=[],u=x,d=this,e=null,i=null,m=x;function r(){c.sort(function(e,r){return l.markerTip.time(e)-l.markerTip.time(r)})}function t(e){e.forEach(function(e){var t,a,r,i;e.key=(t=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})),d.el().querySelector(".vjs-progress-holder").appendChild((a=e,i=y.default.createEl("div",{},{"data-marker-key":a.key,"data-marker-time":l.markerTip.time(a)}),f(a,i),i.addEventListener("click",function(e){var r=!1;if("function"==typeof l.onMarkerClick&&(r=!1===l.onMarkerClick(a)),!r){var t=this.getAttribute("data-marker-key");d.currentTime(l.markerTip.time(s[t]))}}),l.markerTip.display&&((r=i).addEventListener("mouseover",function(){r.classList.add("vjs-bookmark--focus")}),r.addEventListener("mouseout",function(){r.classList.remove("vjs-bookmark--focus")})),i)),s[e.key]=e,c.push(e)}),r()}function f(e,r){r.className="vjs-bookmark "+(e.class||""),r.innerHTML='\n        <div>\n            <div class="vjs-bookmark__content">\n                <span class="udi udi-bookmark"></span>\n                <label class="sr-only" for="bookmark_title">Bookmark title</label>\n                <textarea class="marker-content" id="bookmark-'+e.key+'" maxlength="140" style="height: 35px;" placeholder="enter bookmark title">'+e.text+'</textarea>\n                \x3c!--<span class="vjs-bookmark__content__placeholder">Click to add a comment.</span>--\x3e\n                <span class="vjs-bookmark__content__counter" id="bookmark-title-counter">140</span>\n                <span class="udi udi-delete" id="remove-bookmark-tooltip"></span>\n                <span class="udi udi-check"></span>\n            </div>\n        </div>\n    ',Object.keys(l.markerStyle).forEach(function(e){r.style[e]=l.markerStyle[e]});var t,a=e.time/d.duration();if((a<0||1<a)&&(r.style.display="none"),r.style.left=(t=e,l.markerTip.time(t)/d.duration()*100+"%"),e.duration)r.style.width=e.duration/d.duration()*100+"%",r.style.marginLeft="0px";else{var i=function(e){var r,t={top:0,bottom:0,left:0,width:0,height:0,right:0};try{r=e.getBoundingClientRect()}catch(e){r=t}return r}(r);r.style.marginLeft=i.width/2+"px"}}function a(e){i&&(m=x,i.style.visibility="hidden"),u=x;var a=[];e.forEach(function(e){var r=c[e];if(r){delete s[r.key],a.push(e);var t=d.el().querySelector(".vjs-marker[data-marker-key='"+r.key+"']");t&&t.parentNode.removeChild(t)}}),a.reverse(),a.forEach(function(e){c.splice(e,1)}),r()}function k(){if(l.breakOverlay.display&&!(u<0)){var e=d.currentTime(),r=c[u],t=l.markerTip.time(r);t<=e&&e<=t+l.breakOverlay.displayTime?(m!==u&&(m=u,i&&(i.querySelector(".vjs-break-overlay-text").innerHTML=l.breakOverlay.text(r))),i&&(i.style.visibility="visible")):(m=x,i&&(i.style.visibility="hidden"))}}function v(){!function(){if(c.length){var e=function(e){return e<c.length-1?l.markerTip.time(c[e+1]):d.duration()},r=d.currentTime(),t=x;if(u!==x){var a=e(u);if(r>=l.markerTip.time(c[u])&&r<a)return;if(u===c.length-1&&r===d.duration())return}if(r<l.markerTip.time(c[0]))t=x;else for(var i=0;i<c.length;i++)if(a=e(i),r>=l.markerTip.time(c[i])&&r<a){t=i;break}t!==u&&(t!==x&&n.onMarkerReached&&n.onMarkerReached(c[t],t),u=t)}}(),k(),n.onTimeUpdateAfterMarkerUpdate&&n.onTimeUpdateAfterMarkerUpdate()}function p(){l.markerTip.display&&(e=y.default.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),d.el().querySelector(".vjs-progress-holder").appendChild(e)),d.markers.removeAll(),t(l.markers),l.breakOverlay.display&&(i=y.default.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(l.breakOverlay.style).forEach(function(e){i&&(i.style[e]=l.breakOverlay.style[e])}),d.el().appendChild(i),m=x),v(),d.on("timeupdate",v),d.off("loadedmetadata")}d.on("loadedmetadata",function(){p()}),d.markers={getMarkers:function(){return c},next:function(){for(var e=d.currentTime(),r=0;r<c.length;r++){var t=l.markerTip.time(c[r]);if(e<t){d.currentTime(t);break}}},prev:function(){for(var e=d.currentTime(),r=c.length-1;0<=r;r--){var t=l.markerTip.time(c[r]);if(t+.5<e)return void d.currentTime(t)}},add:function(e){t(e)},remove:function(e){a(e)},removeAll:function(){for(var e=[],r=0;r<c.length;r++)e.push(r);a(e)},updateTime:function(e){var a;a=e,c.forEach(function(e){var r=d.el().querySelector(".vjs-marker[data-marker-key='"+e.key+"']"),t=l.markerTip.time(e);(a||r.getAttribute("data-marker-time")!==t)&&(f(e,r),r.setAttribute("data-marker-time",t))}),r()},reset:function(e){d.markers.removeAll(),t(e)},destroy:function(){d.markers.removeAll(),i&&i.remove(),e&&e.remove(),d.off("timeupdate",k),delete d.markers}}})});